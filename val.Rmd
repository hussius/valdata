Swedish election data
========================================================

(Data provided by Jens Finnäs)

Load election results and data on municipalities.

```{r:load-data}
library("xlsx")
library("pheatmap")
library("calibrate")
load("valresultat.Rdata")
komm <- read.xlsx("kommundata.xlsx",1)

```
Extract 2014 election results on the municipality level. There are 290 municipalities. There is more fine grained data available, but we will use those later. 

Change column names to shorter ones for plotting purposes and replace NA values with zeroes, since that is what they represent in this case. 

```{r}
k <- res$kommun$val2014R
proc <- k[,c("PROCENT_M","PROCENT_C","PROCENT_FP","PROCENT_KD","PROCENT_S","PROCENT_V","PROCENT_MP","PROCENT_SD","PROCENT_FI")]
rownames(proc)<-k$ID
colnames(proc)<-c("M","C","FP","KD","S","V","MP","SD","FI")
```

Perform PCA on the matrix and color by municipality type.

```{r:pca}
p <- prcomp(proc)

rownames(proc) == komm$code # Check that municipalities are listed in the same order
regiontype <- komm$municipalityTypeBroad
colvec <- rep("black", length(regiontype))
colvec[which(regiontype=="Landsbygd")]<-"green"
colvec[which(regiontype=="Storstadsregion")]<-"red"
```

The first plot is a "score plot" which shows the projections of each municipality onto the two strongest principal components.

```{r:scoreplot}
plot(p$x, col=colvec, pch=20)
legend(-40,-5,legend=c("Landsbygd","Stad","Storstadsregion"),pch=20, col=c("green","black","red"))
```
We see a fairly clear separation between "Storstadsregion" (urban) and "Landsbygd" (rural). Which parties drive this separation? Let's take a look at PC1 (the x axis in our plot) first.  

```{r:loadings}
loading.pc1 <- p$rotation[,1]
barplot(loading.pc1[order(loading.pc1)],las=2)
```
The first principal component seems to reflect an axis between the social democrats and the conservatives - perhaps not a big surprise. Positive loadings in the score plot above (the dots on the right hand side) are associated with a relatively high proportion of S (social democrat) votes. These tend to be rural municipalities. The moderates have a negative loading, and thus municipalities with a relatively high proprotion of M (moderate) votes will be on the left hand side in the score plot (where we see many urban regions.)

```{r:loadings2}
loading.pc2 <- p$rotation[,2]
barplot(loading.pc2[order(loading.pc2)],las=2) # SD (+C) mot resten 
```

The second principal component mainly emphasizes a difference between the Sweden democrats (SD) and the other parties.

We can visualize the loadings for PCs 1 and 2 in a scatter plot.

```{r:loadings12}
loadings.1and2 <- cbind(loading.pc1,loading.pc2)
plot(loadings.1and2, pch=".",xlim=c(-1,1),ylim=c(-1,1))
textxy(loadings.1and2[,1],loadings.1and2[,2],labs=rownames(loadings.1and2), cex=1)
```

This plot could be interpreted as supporting, to a certain extent, the idea of two political axes in Sweden, the right-left axis (in fact more of a M <--> S axis) and a perpendicular traditional-cosmopolitan axis, with SD at one end and V, FI, MP and FP at the other.

Now let us look at a more detailed division into municipality types.

```{r:municipalitytype}
mtype <- komm$municipalityType
table(mtype)
colvec <- rep("red", length(mtype))
colvec[which(mtype=="Förortskommuner till storstäderna")]<-"gray"
colvec[which(mtype=="Större städer")]<-"darkblue"
colvec[which(mtype=="Förortskommuner till större städer")]<-"blue"
colvec[which(mtype=="Glesbygdkommuner")]<-"yellow"
colvec[which(mtype=="Kommuner i glesbefolkad region")]<-"orange"
colvec[which(mtype=="Kommuner i tätbefolkad region")]<-"purple"
colvec[which(mtype=="Pendlingskommuner")]<-"brown"
colvec[which(mtype=="Turism- och besöksnäringskommuner")]<-"green"
colvec[which(mtype=="Varuproducerande kommuner")]<-"pink"
plot(p$x, col=colvec, pch=20)
names <- rep("",nrow(komm))
right <- which(p$x[,1]==max(p$x[,1]))
names[right] <- as.character(komm$name[right])
left <- which(p$x[,1]==min(p$x[,1]))
names[left] <- as.character(komm$name[left])
top <- which(p$x[,2]==max(p$x[,2]))
names[top] <- as.character(komm$name[top])
bottom <- which(p$x[,2]==min(p$x[,2]))
names[bottom] <- as.character(komm$name[bottom])
text(p$x[,1],p$x[,2],labels=names,cex=0.8)
legend(-45,-7,legend=unique(mtype),pch=20,col=c("darkblue","brown","yellow","green","blue","pink","orange","purple","gray","black"),cex=0.7)
```

Color by municipality rating in Fokus (a Swedish weekly publication which ranks the municipalities every year)

```{r:fokus}
plot(p$x, col = terrain.colors(n=290)[komm$fokusRanking],pch=20,main="Fokus rating (green is good, pink is bad)")
```


